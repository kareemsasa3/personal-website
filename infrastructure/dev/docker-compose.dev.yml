services:
  # Workfolio - Development mode with live reloading
  workfolio:
    container_name: portfolio-workfolio-dev
    build:
      context: ../workfolio
      dockerfile: Dockerfile.dev
    environment:
      - NODE_ENV=${DEV_NODE_ENV:-development}
    volumes:
      - ../workfolio:/app
      - /app/node_modules
    command: npm run dev -- --host --no-open
    ports:
      - "${DEV_WORKFOLIO_PORT:-3000}:${DEV_WORKFOLIO_PORT:-3000}"

  # Disable redis-commander in dev by default (profile-only)
  redis-commander:
    profiles: ["monitoring"]

  # Nginx - Always running in development mode (HTTP-only, no SSL)
  nginx:
    container_name: portfolio-nginx-dev
    image: nginx:alpine
    volumes:
      - ../nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ../nginx/conf.d/default.local.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
      - "${NGINX_HTTP_PORT:-80}:80"
    depends_on:
      - workfolio
    command:
      - /bin/sh
      - -c
      - ": > /tmp/default.conf && nginx -g 'daemon off;'"
